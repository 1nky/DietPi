#!/bin/bash
#////////////////////////////////////
# DietPi
#
#////////////////////////////////////
# Created by Dan Knight / daniel_haze@hotmail.com / fuzon.co.uk
#
#////////////////////////////////////
#
# Info:
# - Pi Version 2 = /boot/dietpi/.pi_model (line 1 - 2)
# - Pi Version 1 512mb = /boot/dietpi/.pi_model (line 1 - 1)
# - Pi Version 1 256mb = /boot/dietpi/.pi_model (line 1 - 0)
#////////////////////////////////////

#/////////////////////////////////////////////////////////////////////////////////////
#Obtain Pi version 1/2 by checking memory size
#/////////////////////////////////////////////////////////////////////////////////////

PIMODEL=0

#Get Pi Model ID (check total memory size -10mb, ensures that 256/256 split doesnt come up as Pi 1(256mb) etc)
if (($(free | awk '/^Mem:/{print $2}') > 502000)); then
    PIMODEL=2
elif (($(free | awk '/^Mem:/{print $2}') > 246000)); then
    PIMODEL=1
else
    PIMODEL=0
fi

#Get description for use in all scripts
PIMODEL_DESCRIPTION='Unknown Model'
if [ "$PIMODEL" = 2 ]; then
	PIMODEL_DESCRIPTION='Pi 2 (1GB)'
elif [ "$PIMODEL" = 1 ]; then
	PIMODEL_DESCRIPTION='Pi 1 (512MB)'
elif [ "$PIMODEL" = 0 ]; then
	PIMODEL_DESCRIPTION='Pi 1 (256MB)'
fi

#Clear previous file
rm /boot/dietpi/.pi_model &> /dev/null

#Save model Index (LINE 1)
echo "$PIMODEL" >> /boot/dietpi/.pi_model

#Save Pi Description (LINE 2)
echo "$PIMODEL_DESCRIPTION" >> /boot/dietpi/.pi_model

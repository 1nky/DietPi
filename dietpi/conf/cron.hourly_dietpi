#!/bin/bash
{
	#////////////////////////////////////
	# DietPi Cron.Hourly script
	#
	#////////////////////////////////////
	#
	# Info:
	# - Location /etc/cron.hourly/dietpi
	#
	#////////////////////////////////////

#V117	LOGGING_MODE=0
	INDEX_LOGGING_CURRENT=0
	if [ -f /DietPi/dietpi/.installed ]; then
#V117		LOGGING_MODE=$(cat /DietPi/dietpi/.installed | grep 'INDEX_LOGGING_CURRENT ' | awk '{print $2}')
		. /DietPi/dietpi/.installed
	fi

	NTPD_UPDATE_MODE=$(cat /DietPi/dietpi.txt | grep -m1 '^ntpd_update_mode=' | sed 's/.*=//')

	#----------------------------------------------------------------
	# Main Loop
	#----------------------------------------------------------------
	#Update NTP
	if (( $NTPD_UPDATE_MODE == 3 )); then
		killall -w ntpd &> /dev/null
		ntpd -gq -l /var/log/ntpd.log &> /dev/null &
	fi
	#----------------------------------------------------------------
	# Logging
	# - clear all log files.
#V117	if (( $LOGGING_MODE == -1 )); then
	if (( $INDEX_LOGGING_CURRENT == -1 )); then
		/DietPi/dietpi/dietpi-logclear 1 &> /dev/null
	# - Update current log files data to /"$HOME"/logfile_storage/*. Then clear.
#V117	elif (( $LOGGING_MODE == -2 )); then
	if (( $INDEX_LOGGING_CURRENT == -2 )); then
		/DietPi/dietpi/dietpi-logclear 0 &> /dev/null
	fi
	#----------------------------------------------------------------
	exit
	#----------------------------------------------------------------
}

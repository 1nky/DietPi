#!/bin/bash
#////////////////////////////////////
# DietPi CPU Gov Script
#
#////////////////////////////////////
# Created by Dan Knight / daniel_haze@hotmail.com / fuzon.co.uk
#
#////////////////////////////////////
#
# Info:
# - Runs at boot up /etc/dietpi/boot
# - Sets CPU governor | ondemand | powersave | performance
# - Sets CPU governor user prefs | ondemand throttle up percent
#////////////////////////////////////

#/////////////////////////////////////////////////////////////////////////////////////
# Main Loop
#/////////////////////////////////////////////////////////////////////////////////////
#Set Cpu Governor (0 applies to all cpu cores)
CPU_GOVERNOR=$(cat /boot/dietpi.txt | grep 'cpu_governor=' | sed 's/cpu_governor=//g')
echo "$CPU_GOVERNOR" > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor

#Set CPU governor ondemand throttle up percent
if [ "$CPU_GOVERNOR" = ondemand ]; then
	CPU_UP_THROTTLE_PERCENT=$(cat /boot/dietpi.txt | grep 'cpu_usage_throttle_up' | sed 's/cpu_usage_throttle_up=//g')
	echo "$CPU_UP_THROTTLE_PERCENT" > /sys/devices/system/cpu/cpufreq/ondemand/up_threshold
fi
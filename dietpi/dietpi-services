#!/bin/bash
{
	#////////////////////////////////////
	# DietPi Services Script
	#
	#////////////////////////////////////
	# Created by Dan Knight / daniel_haze@hotmail.com / fuzon.co.uk
	#
	# Info:
	# - Allows service control for all programs used in dietpi-software
	# - Disable removes the autostart from init.d. This allows DietPi to control startup services.
	#
	# Usage:
	# - Called from rc.local
	# - /DietPi/dietpi/dietpi-services start/stop/restart/disable
	#////////////////////////////////////

	aSERVICES=(
		"cron"
		"transmission-daemon"
		"proftpd"
		"samba"
		"vsftpd"
		"apache2"
		"nginx"
		"mysql"
		"php5-fpm"
		"mpd"
		"ympd"
		"minidlna"
		"noip2"
		"vpnserver"
		"grasshopper"
		"dnsmasq"
		"subsonic"
		"webiopi"
		"haproxy"
	)

	#/////////////////////////////////////////////////////////////////////////////////////
	# Main
	#/////////////////////////////////////////////////////////////////////////////////////

	#disable
	if [ "$1" = "disable" ]; then
		for ((i=0; i<${#aSERVICES[@]}; i++))
		do
			update-rc.d -f ${aSERVICES[$i]} disable &> /dev/null
		done

	#start/stop/restart
	else
		echo -e "\n DietPi-Services"
		echo -e " Mode: $1"
		echo -e " Please wait......"

		for ((i=0; i<${#aSERVICES[@]}; i++))
		do
			service ${aSERVICES[$i]} $1 &> /dev/null
		done

		#Non-service based control for specific software
		/etc/raspimjpeg_init $1 &> /dev/null
		/etc/deluge_init $1 &> /dev/null
		/etc/squeezeboxserver_init $1 &> /dev/null

		echo -e " Completed"

		#Set Nice
		if [ "$1" = "start" ]; then
			echo -e "\n DietPi-Nice\n Applying nice levels....."
			/DietPi/dietpi/dietpi-nice 1
			echo -e " Completed\n"
		fi

	fi

	#-----------------------------------------------------------------------------------
	unset aSERVICES
	#-----------------------------------------------------------------------------------
	exit
	#-----------------------------------------------------------------------------------
}
#!/bin/bash
{
	#////////////////////////////////////
	# DietPi Patch File Script
	#
	#////////////////////////////////////
	# Created by Dan Knight / daniel_haze@hotmail.com / fuzon.co.uk
	#
	#////////////////////////////////////
	#
	# Info:
	# - Online patching for hosts filesystem.
	# - Runs from dietpi-update
	#
	# Usage:
	# - /DietPi/dietpi/patch_file iCurrentVersion iServerVersion
	#////////////////////////////////////

	#/////////////////////////////////////////////////////////////////////////////////////
	#Globals
	#/////////////////////////////////////////////////////////////////////////////////////
	VERSION_CURRENT=$1
	VERSION_SERVER=$2

	HW_MODEL=$(sed -n 1p /DietPi/dietpi/.hw_model)
	HW_MODEL_DESCRIPTION=$(sed -n 2p /DietPi/dietpi/.hw_model)
	DISTRO=$(sed -n 3p /DietPi/dietpi/.hw_model)

	#/////////////////////////////////////////////////////////////////////////////////////
	# Func
	#/////////////////////////////////////////////////////////////////////////////////////
	#new software installation for dietpi-software. Update to users .installed file
	DietPi_Software_Addition(){

		#DietPi_Software_Addition STRING INT
		#							|	  |
		#							|	  Installed state (0, 2=installed)
		#							Name

		local input_string="$1"
		local input_value=$2

		#Has installed file
		if [ -f /DietPi/dietpi/.installed ]; then

			#Check for previous entry
			if (( $(cat /DietPi/dietpi/.installed | grep -ci -m1 "$input_string " ) == 0 )); then

				#Add new entry
				echo -e "$input_string $input_value" >> /DietPi/dietpi/.installed

			fi

		fi
	}

	#/////////////////////////////////////////////////////////////////////////////////////
	# Main Loop
	#/////////////////////////////////////////////////////////////////////////////////////
	#Info
	echo -e "Patching $VERSION_CURRENT to $VERSION_SERVER"

	if (( $VERSION_CURRENT == 102 )); then
		echo -e "102 > 103 patch"
		#-------------------------------------------------------------------------------
		#-------------------------------------------------------------------------------

	elif (( $VERSION_CURRENT == 103 )); then
		echo -e "103 > 104 patch"
		#-------------------------------------------------------------------------------
		#-------------------------------------------------------------------------------

	fi

		#-------------------------------------------------------------------------------
		# If we need to apt-get anything, wait for apt-get update thread to finish.
		#/DietPi/dietpi/dietpi-apt-get_update 1

		#New dietpi-software additions
		#DietPi_Software_Addition SOFTWARENAME 0
		#-------------------------------------------------------------------------------

	#-------------------------------------------------------------------------------
	sleep 0.25
	#-------------------------------------------------------------------------------
	exit
	#-------------------------------------------------------------------------------
}